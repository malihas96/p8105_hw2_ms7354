---
title: "p8105_hw2_ms7354"
author: "Maliha Safdar"
date: "2025-09-30"
output: github_document
---

```{r}
library(tidyverse)
library(dplyr)
library(readr)
library(readxl)
```



###Problem 1

`First, clean the data in pols-month.csv. Use separate() to break up the variable mon into integer variables year, month, and day; replace month number with month name; create a president variable taking values gop and dem, and remove prez_dem and prez_gop; and remove the day variable.`


```{r}
pols_month_df = 
  read.csv("./data/pols-month.csv") |>
  janitor::clean_names()

mon_separated <- pols_month_df |>
  separate(mon,into = c("year", "month", "date"), sep = "-") |>
  mutate(
    year  = as.integer(year),
    month = as.integer(month),
    date  = as.integer(date),
    month = factor(month, levels = 1:12, labels = base::month.name, ordered = TRUE),
    president = 
      case_match(
        prez_gop, 
        0 ~ "dem", 
        1 ~ "gop"),
    prez_gop = as.factor(prez_gop)
    ) |>
  select(-prez_dem, -prez_gop, -date) |>
  relocate(year,month, president)
```


`Second, clean the data in snp.csv using a similar process to the above. For consistency across datasets, arrange according to year and month, and organize so that year and month are the leading columns.`


```{r}
snp_df = 
  read.csv("./data/snp.csv") |>
  janitor::clean_names()

snp_date_separated <- snp_df |>
  separate(date, into = c ("day", "month", "year"), sep = "/") |>
  mutate(
    day = as.integer(day),
    month = as.integer(month),
    year = as.integer(year),
    month = factor(month, levels = 1:12, labels = base::month.name, ordered = TRUE),
     year4 = case_when(
      nchar(as.character(year)) == 4 ~ year,          
      year <= 24                     ~ 2000L + year,  
      TRUE                           ~ 1900L + year  
    )
  ) |>
  
  select(-day, -year) |>
  
  relocate(year4, month) |>
  
  rename(year = year4)
```

`Third, tidy the unemployment data so that it can be merged with the previous datasets. This process will involve switching from “wide” to “long” format; ensuring that key variables have the same name; and ensuring that key variables take the same values.`

```{r}
unemployment_df =
  read.csv("./data/unemployment.csv") |>
  janitor::clean_names()

unemployment_tidy_df = 
  pivot_longer(
    unemployment_df, 
    jan:dec,
    names_to = "month", 
    values_to = "percentage_umemployed") |>
  mutate(
    month = factor(
      str_to_title(month),
      levels = month.abb,
      labels = base::month.name,
      ordered = TRUE
    )
  ) |>
  relocate(year,month)
```

`joining the three datasets. Join the datasets by merging snp into pols, and merging unemployment into the result.`

```{r}
snp_pols =
  left_join(snp_date_separated,mon_separated, by = c("year", "month"))

final_df =
  left_join(snp_pols,unemployment_tidy_df, by = c("year", "month"))
```

`Insert the blurb for Problem 1.`



### Problem 2

`Read and clean the Mr. Trash Wheel sheet:

specify the sheet in the Excel file and to omit non-data entries (rows with notes / figures; columns containing notes) using arguments in read_excel
use reasonable variable names
omit rows that do not include dumpster-specific data
round the number of sports balls to the nearest integer and converts the result to an integer variable (using as.integer)`

###The mr_trash, prof_trash and gwynnda dataframe should have the last row removed.
```{r}
mr_trash <- readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",
  range = "A2:N709") |>
  janitor::clean_names() |>
  mutate(
  sports_balls = as.integer(round(sports_balls)),
  homes_powered = as.integer(round(homes_powered)),
  year = as.numeric(year),
  trash_name = "mr_trash"
  )|>
  select( -"date") |>
  relocate(year, month)
```
`Use a similar process to import, clean, and organize the data for Professor Trash Wheel and Gwynnda, and combine this with the Mr. Trash Wheel dataset to produce a single tidy dataset. To keep track of which Trash Wheel is which, you may need to add an additional variable to both datasets before combining.`

```{r}
prof_trash <- readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = "A2:M134") |>
  janitor::clean_names() |>
  select( -"date") |>
  relocate(year, month, dumpster) |>
  mutate(
  homes_powered = as.integer(round(homes_powered)),
  trash_name = "prof_trash",
  year = as.numeric(year)
  )
```


```{r}
gwynnda <- readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  range = "A2:L351") |>
  janitor::clean_names() |>
  select( -"date") |>
  relocate(year, month, dumpster) |>
  mutate(
  homes_powered = as.integer(round(homes_powered)),
  trash_name = "gwynnda"
  )
```


`Combining all three datasets.`

```{r}
trash_all =
  bind_rows(mr_trash,prof_trash,gwynnda) |>
  janitor::clean_names() |>
  select(trash_name, everything())


trash_tidy_all = 
  pivot_longer(
    trash_all,
    plastic_bottles:sports_balls,
    names_to = "trash_type",
    values_to = "units_collected"
  ) |>
  relocate(trash_name, year, month, dumpster, trash_type, units_collected)
  
```

`Insert blurb.`



### Problem 3

`Create a single, well-organized dataset with all the information contained in these data files. To that end: import, clean, tidy, and otherwise wrangle each of these datasets; check for completeness and correctness across datasets (e.g. by viewing individual datasets and monitoring warning messages); merge to create a single, final dataset; and organize this so that variables and observations are in meaningful orders.`


```{r}
zori =
  read.csv("./data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |>
  janitor::clean_names() |>
  rename(zip_code = region_name) |>
  pivot_longer(
    -(region_id:county_name),
    names_to = "date",
    values_to = "rent_price"
  ) |>
  mutate(
  date = format(
    as.Date(gsub
        ("^x(\\d{4})_(\\d{2})_(\\d{2})$", "\\1-\\2-\\3", date),
        "%Y-%m-%d"),"%d/%m/%Y")
  )


zip_codes = 
  read.csv("./data/Zip Codes.csv") |>
  janitor::clean_names() |>
  mutate(
    county_name = 
        case_match(
        county,
        "Bronx" ~ "Bronx County",
        "Kings" ~ "Kings County",
        "New York" ~ "New York County",
        "Queens" ~ "Queens County",
        "Richmond" ~ "Richmond County")
    
  )|>
  relocate(zip_code,neighborhood, county_name,county_code)

```


`Joinning both the datasets.`

```{r}
zori_zip =
  left_join(zori,zip_codes, by = c("zip_code", "county_name")) |>
  relocate(date,county_name, neighborhood,rent_price)
```

