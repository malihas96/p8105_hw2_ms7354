---
title: "p8105_hw2_ms7354"
author: "Maliha Safdar"
date: "2025-09-30"
output: github_document
---

```{r}
library(tidyverse)
library(dplyr)
library(readr)
library(readxl)
```



### Problem 1


```{r}
pols_month_df = 
  read.csv("./data/pols-month.csv") |>
  janitor::clean_names()

mon_separated <- pols_month_df |>
  separate(mon,into = c("year", "month", "date"), sep = "-") |>
  mutate(
    year  = as.integer(year),
    month = as.integer(month),
    date  = as.integer(date),
    month = month.name[month],
    president = 
      case_match(
        prez_gop, 
        0 ~ "dem", 
        1 ~ "gop"),
    prez_gop = as.factor(prez_gop)
    ) |>
  select(-prez_dem, -prez_gop, -date) |>
  relocate(year,month, president)
```




```{r}
snp_df = 
  read.csv("./data/snp.csv") |>
  janitor::clean_names()

snp_date_separated <- snp_df |>
  separate(date, into = c ("day", "month", "year"), sep = "/") |>
  mutate(
    day = as.integer(day),
    month = as.integer(month),
    year = as.integer(year),
    month = month.name[month],
     year = case_when(
      year <= 24         ~ 2000L + year,
      TRUE               ~ 1900L + year
      
  )
    )|>
  select(-day) |>
  relocate(year, month)
```



```{r}
unemployment_df =
  read.csv("./data/unemployment.csv") |>
  janitor::clean_names()

unemployment_tidy_df = 
  pivot_longer(
    unemployment_df, 
    jan:dec,
    names_to = "month", 
    values_to = "percentage_unemployed") |>
  mutate(
    month = factor(
      str_to_title(month),
      levels = month.abb,
      labels = base::month.name,
      ordered = TRUE
    )
  ) |>
  relocate(year,month)
```

`Joining the three datasets.`

```{r}
snp_pols =
  left_join(mon_separated,snp_date_separated, by = c("year", "month"))

final_df =
  left_join(unemployment_tidy_df,snp_pols, by = c("year", "month")) |>
  relocate("year", "month", "president", "percentage_unemployed", "close")

head(final_df)
tail(final_df)
```

`The pol_mon dataset contains data related to national politicians who are democratic or republican at any given time. The snp dataset contains data related to Standard & Poor's stock market index (S&P) which is usually used as a representative measure of stock market as a whole. The umemployment dataset contains information about percentage of unemployment by year and month. The final dataset that contains the above mentioned three datasets gives us information on when democratic or republican politicians are elected and the s&p stock market price and unemployment percentages over the period of years. The final dataset has 1385 observations, and ranges from 1948 to 2015, so a range of 67 years, and the key varaiables are year, month, percent_unemployed, president and close.`



### Problem 2

```{r}
mr_trash <- readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Mr. Trash Wheel",
  range = "A2:N709") |>
  janitor::clean_names() |>
  mutate(
  sports_balls = as.integer(round(sports_balls)),
  homes_powered = as.integer(round(homes_powered)),
  year = as.numeric(year),
  trash_name = "mr_trash"
  )|>
  select( -"date") |>
  relocate(year, month)
```


```{r}
prof_trash <- readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Professor Trash Wheel",
  range = "A2:M134") |>
  janitor::clean_names() |>
  select( -"date") |>
  relocate(year, month, dumpster) |>
  mutate(
  homes_powered = as.integer(round(homes_powered)),
  trash_name = "prof_trash",
  year = as.numeric(year)
  )


```


```{r}
gwynnda <- readxl::read_excel("./data/202509 Trash Wheel Collection Data.xlsx",
  sheet = "Gwynns Falls Trash Wheel",
  range = "A2:L351") |>
  janitor::clean_names() |>
  select( -"date") |>
  relocate(year, month, dumpster) |>
  mutate(
  homes_powered = as.integer(round(homes_powered)),
  trash_name = "gwynnda"
  )
```


`Combining all three datasets.`

```{r}
trash_all =
  bind_rows(mr_trash,prof_trash,gwynnda) |>
  janitor::clean_names() |>
  select(trash_name, everything()) |>
  relocate(trash_name, year, month, dumpster)

prof_weight_tons <- sum(prof_trash$weight_tons, na.rm = TRUE)


trash_tidy_all = 
  pivot_longer(
    trash_all,
    plastic_bottles:sports_balls,
    names_to = "trash_type",
    values_to = "units_collected"
  ) |>
  relocate(trash_name, year, month, dumpster, trash_type, units_collected)
  
```

```{r}
cigarrette_buds_gwynnda =
  bind_rows(mr_trash,prof_trash,gwynnda) |>
  janitor::clean_names() |>
  select(trash_name, everything()) |>
  relocate(trash_name, year, month, dumpster) |>
  filter(trash_name == "gwynnda", year == 2022, month %in% c("June","Jun")) |>
  summarise(total_cig_butts = sum(cigarette_butts, na.rm = TRUE))
```

`The resulting dataset is trash_all which contains the trash in weight (tons) and volume(cubic yards) along with the different types of trash collected accross a period of time. It contains the trash that has been collected from Mr. Trash Wheel, Professor Trash Wheel and Gwynns Fall Trash Wheel which are the names given to the different trash wheel at different locations. The trash_all dataset has 1188 observations with data collected from 2014 up until 2025. The key variables are year, month, trash_name, weight_tons, and volume_cubic_yd. The total weight in tons of trash collected by Professor Trash Wheel is 282.26 in tons. The total number of cigarrette butts collected by gwynnda in 2022 was 18120.`



### Problem 3


```{r}
zori =
  read.csv("./data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv") |>
  janitor::clean_names() |>
  rename(zip_code = region_name) |>
  pivot_longer(
    -(region_id:county_name),
    names_to = "date",
    values_to = "rent_price"
  ) |>
  mutate(
  date = str_remove(date,"x"),
    date = ymd(date)
  )


zip_codes = 
  read.csv("./data/Zip Codes.csv") |>
  janitor::clean_names() |>
  mutate(
    county_name = 
        case_match(
        county,
        "Bronx" ~ "Bronx County",
        "Kings" ~ "Kings County",
        "New York" ~ "New York County",
        "Queens" ~ "Queens County",
        "Richmond" ~ "Richmond County")
    
  )|>
  relocate(zip_code,neighborhood, county_name,county_code)

```


`Joining both the datasets. Before joining I want to look which observations might be missing or NA.`

```{r}
missing_values = 
  anti_join(zori,zip_codes)
#Queens county zip code 11693 has 116 obs that have NA rent price.

zori_zip =
  left_join(zori,zip_codes, by = c("zip_code", "county_name")) |>
  relocate(date,county_name, neighborhood,rent_price,zip_code) |>
  mutate(
    zip_code = as.character(zip_code)
  )
skimr::skim(zori_zip)
```

`There are a total of 17284 observations in this resulting tidy dataset which I have indicated as zori_zip. There are 149 unique zip codes and 42 unique neighborhoods.`


```{r}
zori_zip =
  left_join(zori,zip_codes, by = c("zip_code", "county_name")) |>
  relocate(date,county_name, neighborhood,rent_price,zip_code)

zori_zip_missing =
  anti_join(zip_codes,zori, by = "zip_code") |>
  mutate(
    zip_code = as.character(zip_code)
  )

  skimr::skim(zori_zip_missing)

```
`There are 171 zip codes that appear in zip_codes dataset but not in the zori dataset. Some examples of missing zip codes from the zori dataset are as follows:`

```{r}
head(zori_zip_missing, 6) |>
knitr::kable()
```

```{r}
price_change = zori_zip |>
  filter(
    date %in% c ("2020-01-31","2021-01-31")) |>
  select(zip_code,county_name,neighborhood,date, rent_price) |>
  pivot_wider(
    names_from = date,
    values_from = rent_price) |> # separated the date columns by rent price so now they show the difference or change in rent price. 
  mutate(
    county_name = 
        case_match(
        county_name,
        "Bronx County" ~ "The Bronx",
        "Kings County" ~ "Brooklyn",
        "New York County" ~ "Manhattan",
        "Queens County" ~ "Queens",
        "Richmond County" ~ "Staten Island"),
    price_fluc = `2021-01-31` - `2020-01-31`) |>
    drop_na(neighborhood) |>
    rename(bourough = "county_name") |>
    arrange(price_fluc)
  
head(price_change, 10) |>
knitr::kable()
```
`In the table above, we can see that the largest drop in rent price was $913 in the Manhattan bourough, in lower Manhattan neighborhood. On January 31st of 2020 the rent price was $6334 and exactly one year later it dropped to $5422.`


